<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.2"?>
<!--
    Copyright (c) 2010-2011 Red Hat Inc. and others.
    All rights reserved. This program and the accompanying materials
    are made available under the terms of the Eclipse Public License v1.0
    which accompanies this distribution, and is available at
    http://www.eclipse.org/legal/epl-v10.html
   
    Contributors:
        Red Hat Inc. - initial API and implementation
 -->

<plugin>
   <extension-point id="org.fedoraproject.eclipse.packager.koji.instance" name="kojiInstance" schema="schema/org.fedoraproject.eclipse.packager.koji.instance.exsd"/>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            locationURI="popup:org.eclipse.fedoraproject.packager.main?before=org.fedoraproject.eclipse.packager.kojisep">
                     <command
                  commandId="org.fedoraproject.eclipse.packager.koji.BuildCommand"
                  icon="icons/Artwork_DesignService_koji-icon-16.png"
                  label="%command.label.0"
                  mnemonic="%command.mnemonic.0"
                  style="push">
               <visibleWhen checkEnabled="false">
               <or>
                  <with variable="activeMenuSelection">
                     <reference definitionId="org.fedoraproject.eclipse.packager.project"/>
                  </with>
                  <with variable="activeMenuEditorInput">
                     <reference definitionId="org.fedoraproject.eclipse.packager.project"/>
                  </with>
               </or>
            </visibleWhen>

                  </command>
                     <command
                           commandId="org.fedoraproject.eclipse.packager.koji.ScratchBuildCommand"
                           icon="icons/Artwork_DesignService_koji-icon-16.png"
                           label="%command.label.1"
                           mnemonic="%command.mnemonic.1"
                           style="push">
                        <visibleWhen
                              checkEnabled="false">
                           <or>
                              <with
                                    variable="activeMenuSelection">
                                 <reference
                                       definitionId="org.fedoraproject.eclipse.packager.project">
                                 </reference>
                              </with>
                              <with
                                    variable="activeMenuEditorInput">
                                 <reference
                                       definitionId="org.fedoraproject.eclipse.packager.project">
                                 </reference>
                              </with>
                           </or>
                        </visibleWhen>
                     </command>
                     <command
                           commandId="org.fedoraproject.eclipse.packager.koji.SRPMScratchBuildCommand"
                           icon="icons/Artwork_DesignService_koji-icon-16.png"
                           label="%command.label.2"
                           style="push">
                        <visibleWhen
                              checkEnabled="false">
                           <or>
                              <with
                                    variable="activeMenuSelection">
                                 <reference
                                       definitionId="org.fedoraproject.eclipse.packager.project">
                                 </reference>
                              </with>
                              <with
                                    variable="activeMenuEditorInput">
                                 <reference
                                       definitionId="org.fedoraproject.eclipse.packager.project">
                                 </reference>
                              </with>
                              <with
                                    variable="activeMenuSelection">
                                 <and>
                                    <reference
                                          definitionId="org.fedoraproject.eclipse.packager.localproject">
                                    </reference>
                                    <iterate
                                          ifEmpty="false"
                                          operator="and">
                                       <adapt
                                             type="org.eclipse.core.resources.IResource">
                                          <test
                                                forcePluginActivation="false"
                                                property="org.fedoraproject.eclipse.packager.fedoraCertExists"
                                                value="true">
                                          </test>
                                       </adapt>
                                    </iterate>
                                 </and>
                              </with>
                              <with
                                    variable="activeMenuEditorInput">
                                 <and>
                                    <reference
                                          definitionId="org.fedoraproject.eclipse.packager.localproject">
                                    </reference>
                                    <iterate
                                          ifEmpty="false"
                                          operator="and">
                                       <adapt
                                             type="org.eclipse.core.resources.IResource">
                                          <test
                                                forcePluginActivation="false"
                                                property="org.fedoraproject.eclipse.packager.fedoraCertExists"
                                                value="true">
                                          </test>
                                       </adapt>
                                    </iterate>
                                 </and>
                              </with>
                           </or>
                        </visibleWhen>
                     </command>
      </menuContribution>
      <menuContribution
            allPopups="false"
            locationURI="toolbar:org.eclipse.ui.main.toolbar">
         <toolbar
               id="org.fedoraproject.eclipse.packager.koji.toolbar">
            <command
                  commandId="org.fedoraproject.eclipse.packager.koji.ChainBuildCommand"
                  icon="icons/chain-build-dummy.png"
                  label="%command.name.3"
                  style="push">
               <visibleWhen
                     checkEnabled="false">
                  <with
                        variable="activeWorkbenchWindow.activePerspective">
                     <equals
                           value="org.fedoraproject.eclipse.packager.perspective">
                     </equals>
                  </with>
               </visibleWhen>
            </command>
         </toolbar>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.ui.commands">
      <command
            defaultHandler="org.fedoraproject.eclipse.packager.koji.internal.handlers.KojiBuildHandler"
            id="org.fedoraproject.eclipse.packager.koji.BuildCommand"
            name="%command.name.0">
      </command>
      <command
            defaultHandler="org.fedoraproject.eclipse.packager.koji.internal.handlers.KojiScratchBuildHandler"
            id="org.fedoraproject.eclipse.packager.koji.ScratchBuildCommand"
            name="%command.name.1">
      </command>
      <command
            defaultHandler="org.fedoraproject.eclipse.packager.koji.internal.handlers.KojiSRPMScratchBuildHandler"
            id="org.fedoraproject.eclipse.packager.koji.SRPMScratchBuildCommand"
            name="%command.name.2">
      </command>
      <command
            defaultHandler="org.fedoraproject.eclipse.packager.koji.internal.handlers.ChainBuildHandler"
            id="org.fedoraproject.eclipse.packager.koji.ChainBuildCommand"
            name="%command.name.3">
      </command>
   </extension>
   <extension
          point="org.fedoraproject.eclipse.packager.packagerCommandContribution">
       <command id="KojiBuildCommand"
       	        class="org.fedoraproject.eclipse.packager.koji.api.KojiBuildCommand">
       </command>
       <command
             class="org.fedoraproject.eclipse.packager.koji.api.KojiUploadSRPMCommand"
             id="KojiUploadSRPMCommand">
       </command>
   </extension>
   <!-- Keyboard shortcut definitions -->
   <extension
         point="org.eclipse.ui.bindings">
      <key
            commandId="org.fedoraproject.eclipse.packager.koji.BuildCommand"
            contextId="org.eclipse.ui.contexts.window"
            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"
            sequence="M1+M3+F K">
      </key>
      <key
            commandId="org.fedoraproject.eclipse.packager.koji.ScratchBuildCommand"
            contextId="org.eclipse.ui.contexts.window"
            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"
            sequence="M1+M3+F X">
      </key>
      <key
            commandId="org.fedoraproject.eclipse.packager.koji.SRPMScratchBuildCommand"
            contextId="org.eclipse.ui.contexts.window"
            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"
            sequence="M1+M3+F U">
      </key>
    </extension>
   <extension
         point="org.eclipse.ui.preferencePages">
      <page
            category="org.fedoraproject.eclipse.packager.preferences"
            class="org.fedoraproject.eclipse.packager.koji.internal.preferences.FedoraPackagerKojiPreferencePage"
            id="org.fedoraproject.eclipse.packager.preferences.koji"
            name="Koji">
      </page>
   </extension>
   <extension
         point="org.eclipse.equinox.preferences.preferences">
      <initializer
            class="org.fedoraproject.eclipse.packager.koji.internal.preferences.FedoraPackagerKojiPreferenceInitializer">
      </initializer>
   </extension>
   <extension
         point="org.eclipse.ui.propertyPages">
      <page
            class="org.fedoraproject.eclipse.packager.koji.internal.preferences.KojiProjectPropertyPage"
            id="org.fedoraproject.eclipse.packager.koji.ui.KojiProjectPropertyPage"
            name="Fedora Packager Koji">
         <enabledWhen>
            <adapt
                  type="org.eclipse.core.resources.IResource">
               <or>
                  <test
                        args="org.fedoraproject.eclipse.packager.project, true"
                        property="org.eclipse.core.resources.projectPersistentProperty">
                  </test>
                  <test
                        args="org.fedoraproject.eclipse.packager.localproject, true"
                        property="org.eclipse.core.resources.projectPersistentProperty">
                  </test>
               </or>
            </adapt>
         </enabledWhen>
      </page>
   </extension>
    <extension
         point="org.fedoraproject.eclipse.packager.koji.instance">
      <instance
            customTargets="false"
            name="Default Fedora Koji Instance"
            webUrl="http://koji.fedoraproject.org/koji"
            xmlrpcUrl="https://koji.fedoraproject.org/kojihub">
      </instance>
      <instance
            customTargets="true"
            name="Fedora ARM"
            webUrl="http://arm.koji.fedoraproject.org/koji"
            xmlrpcUrl="https://arm.koji.fedoraproject.org/kojihub">
      </instance>
      <instance
            customTargets="true"
            name="Fedora s390x"
            webUrl="http://s390.koji.fedoraproject.org/koji"
            xmlrpcUrl="https://s390.koji.fedoraproject.org/kojihub">
      </instance>
      <instance
            customTargets="true"
            name="Fedora PowerPC"
            webUrl="http://ppc.koji.fedoraproject.org/koji"
            xmlrpcUrl="https://ppc.koji.fedoraproject.org/kojihub">
      </instance>
   </extension>

</plugin>
